<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iscas.sdas.dao.cell.CellDao">
	<select id="getcells" resultType="com.iscas.sdas.dto.cell.CellDto">
		select
		e_utrancell,network_name,used_band,cover_scene,station_name,group_type
		from
		table_cell_base_station, t_groupBaseInfo,t_cell_info where
		table_cell_base_station.network_name = t_groupBaseInfo.cell_code and
		table_cell_base_station.network_name = t_cell_info.cell_code and
		t_cell_info.in_used = 1
		<if test="network_name != null">
			<bind name="network_name" value="'%'+ _parameter.getNetwork_name() +'%'" />
			and table_cell_base_station.network_name like #{network_name}
		</if>
		<if test="cover_scene != null">
			and table_cell_base_station.cover_scene like
			#{cover_scene}
		</if>
		<if test="group_type != null">
			and t_groupBaseInfo.group_type like #{group_type}
		</if>
		limit 1000
	</select>
	<select id="getgroups" resultType="java.lang.String">
		select
		cover_scene
		from
		table_cell_base_station,
		t_groupBaseInfo,t_cell_info_special where
		table_cell_base_station.network_name = t_groupBaseInfo.cell_code and
		table_cell_base_station.network_name = t_cell_info_special.cell_code
		GROUP BY table_cell_base_station.cover_scene
		limit 1000
	</select>
	<select id="getgroupindexs" resultType="com.iscas.sdas.dto.GroupIndexMeatdata"
		parameterType="java.lang.String">
		SELECT
		t_groupDetailInfo.cell_code,t_groupDetailInfo.indeicator_code,
		t_normalcheckmetadata.indeicator_name FROM
		t_groupDetailInfo,t_normalcheckmetadata
		WHERE t_groupDetailInfo.indeicator_code =
		t_normalcheckmetadata.indeicator_id AND t_groupDetailInfo.cell_code =
		#{grouptype}
	</select>
	<select id="getgroupindexcontent" resultType="com.iscas.sdas.dto.cell.BaseGroupIndex">
		SELECT * FROM t_groupDetailInfo WHERE t_groupDetailInfo.cell_code = #{0} AND t_groupDetailInfo.indeicator_code=#{1};
	</select>
	<select id="getgroup" parameterType="java.lang.String" resultType="java.lang.String">
		SELECT group_type FROM t_groupBaseInfo WHERE cell_code = #{cellname} LIMIT 1
	</select>
	<select id="cellhealthtrend" parameterType="java.lang.String" resultType="com.iscas.sdas.dto.cell.BaseCellHealth">
		SELECT * FROM t_cell_health_info WHERE STR_TO_DATE(yyyyMMdd,'%Y-%m-%d') > DATE_SUB((SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1),INTERVAL 7 DAY) AND cell_code=#{cellname} and health_flag = 0 ORDER BY yyyyMMdd
	</select>
	<select id="performWorkWithinCurrTime" resultType="com.iscas.sdas.dto.PerformanceWorkDto" parameterType="java.lang.String">
		SELECT * FROM t_performance_work WHERE cellid = #{cellname} AND occurrence_time BETWEEN DATE_SUB((SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1),INTERVAL 7 DAY) AND (SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1)
	</select>
	<select id="deviceWorkWithinCurrTime" resultType="com.iscas.sdas.dto.DeviceWorkDto" parameterType="java.lang.String">
		SELECT * FROM t_equipment_failure_201708 WHERE cell_name = #{cellname} AND fault_occus_time BETWEEN DATE_SUB((SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1),INTERVAL 7 DAY) AND (SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1)
	</select>
	<select id="osWorkWithinCurrTime" resultType="com.iscas.sdas.dto.OSWorkDto" parameterType="java.lang.String">
		SELECT * FROM t_wireless_retirement WHERE cell_name = #{cellname} AND start_time BETWEEN DATE_SUB((SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1),INTERVAL 7 DAY) AND (SELECT yyyyMMdd FROM t_cell_health_info WHERE cell_code = #{cellname} ORDER BY yyyyMMdd DESC LIMIT 1)
	</select>
</mapper>
